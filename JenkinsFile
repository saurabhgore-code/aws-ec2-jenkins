pipeline{
    agent any
      stages{
          stage("Start instances"){
              steps{
                  withCredentials([[
                      $class: 'AmazonWebServicesCredentialsBinding',
                       credentialsId: 'aws-keys',
                      accessKeyVariable: 'AWS_ACCESS_KEY_ID',
                      secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']]){ 
                      script {
                    if (InstanceName = 'control-machine') {
                        aws ec2 start-instances --instance-ids $InstanceID
                          echo Instance $InstanceID Started
                    } elif (InstanceName = 'control-machine'){
                     aws ec2 stop-instances --instance-ids $InstanceID
                         echo Instance $InstanceID Stopped
                    }
                  }
              }
          }
      }
}
